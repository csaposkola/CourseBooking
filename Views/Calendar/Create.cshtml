@using System.Linq
@using System.Web.Mvc
@using System.Web.Mvc.Html
@using DotNetNuke.Web.Client.ClientResourceManagement
@using DotNetNuke.Framework.JavaScriptLibraries
@using CourseBooking.Models
@inherits DotNetNuke.Web.Mvc.Framework.DnnWebViewPage<BookingEntity>

@{
    DotNetNuke.Framework.JavaScriptLibraries.JavaScript.RequestRegistration(CommonJs.jQuery);
    DotNetNuke.Framework.JavaScriptLibraries.JavaScript.RequestRegistration(CommonJs.jQueryUI);
    DotNetNuke.Framework.ServicesFramework.Instance.RequestAjaxAntiForgerySupport();

    var startTime = ViewBag.StartTime as DateTime? ?? DateTime.Now;
    var localStartTime = startTime.ToLocalTime();
    var coursePlans = ViewBag.CoursePlans as IEnumerable<CoursePlanEntity> ?? Enumerable.Empty<CoursePlanEntity>();
}

<div class="course-booking-form">
    <h2>Create Booking</h2>

    <form action="@Url.Action("Create", "Calendar")" method="post">
        @Html.AntiForgeryToken()

        <div class="form-horizontal">
            <div class="course-section">
                <h3>Course Information</h3>

                <div class="form-group">
                    <label class="control-label col-md-3">Date</label>
                    <div class="col-md-9">
                        <p class="form-control-static">@localStartTime.ToString("d MMMM yyyy")</p>
                        <p class="text-muted">Local Time: @localStartTime.ToString("HH:mm")</p>
                        <p class="text-muted">UTC Time: @startTime.ToString("HH:mm")</p>
                    </div>
                </div>

                <div class="form-group">
                    <label class="control-label col-md-3">Course Plan</label>
                    <div class="col-md-9">
                        <select id="CoursePlanID" name="CoursePlanID" class="form-control" required>
                            <option value="">Select Course Plan</option>
                            @foreach (var plan in coursePlans)
                            {
                                <option value="@plan.ID" data-duration="@plan.DurationHours"
                                        data-description="@plan.Description" data-capacity="@plan.MaxCapacity"
                                        data-price="@plan.Price" data-category="@plan.CourseCategory">
                                    @(plan.Name) (@plan.DurationHours Hours)
                                </option>
                            }
                        </select>
                    </div>
                </div>

                <div id="courseDetails" style="display: none;">
                    <div class="form-group">
                        <label class="control-label col-md-3">Description</label>
                        <div class="col-md-9">
                            <p id="courseDescription" class="form-control-static"></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="participants-section">
                <h3>Participant Information</h3>

                <div id="participantsContainer">
                    <div class="participant-entry" data-index="0">
                        <div class="form-group">
                            <label class="control-label col-md-3">Name</label>
                            <div class="col-md-9">
                                <input type="text" name="participantNames[0]" class="form-control" required />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-md-3">Email</label>
                            <div class="col-md-9">
                                <input type="email" name="participantEmails[0]" class="form-control" required />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-offset-3 col-md-9">
                        <button type="button" id="addParticipant" class="btn btn-default">
                            <i class="fa fa-plus"></i> Add Participant
                        </button>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-offset-3 col-md-9">
                    <input type="hidden" name="StartTime" value="@startTime.ToString("o")" />
                    <input type="hidden" name="DurationHours" id="DurationHours" value="" />
                    <button type="submit" class="btn btn-primary">Complete Booking</button>
                    <a href="@Url.Action("Index")" class="btn btn-default">Cancel</a>
                </div>
            </div>
        </div>
    </form>
</div>

@{
    ClientResourceManager.RegisterStyleSheet(Dnn.DnnPage, "~/DesktopModules/MVC/CourseBooking/module.css");
}

<script type="text/javascript">
    // JavaScript remains unchanged
    $(document).ready(function () {
        // Content unchanged
    });
</script>